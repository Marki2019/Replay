image: archlinux/base

stages:
  - arch
  - flatpak

build_arch:
  stage: arch
  script:
    - pacman -Syu sudo grep git fakeroot binutils --noconfirm
    - useradd builduser -m
    - passwd -d builduser
    - printf 'builduser ALL=(ALL) ALL\n' | tee -a /etc/sudoers
    - sudo -u builduser bash -c 'cd dist/arch && makepkg -s --noconfirm'
  artifacts:
    paths:
      - pkg/

build_flatpak:
  stage: flatpak
  script:
    - pacman -Syu flatpak flatpak-builder --noconfirm
    - flatpak install org.gnome.Platform org.gnome.Sdk
    - flatpak-builder builddir dist/flatpak/com.gitlab.nahuelwexd.Unitube.json
  artifacts:
    paths:
      - builddir/
